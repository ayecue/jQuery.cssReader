var cssReader=function(e){var t=this;var n={targetUrl:"",plainCss:"",fetchedCss:""};this.classIns=new cssReader.classInstance;this.refIns=new cssReader.refInstance;this.compiledIns=new cssReader.compiledInstance;this.attrIns=new cssReader.attrInstance;this.d=$.extend(n,e);this.setUrl=function(e){t.d.targetUrl=e};this.setCss=function(e){t.d.plainCss=cssReader.getCompressedCss(e)};this.fetchCss=function(){t.d.fetchedCss=t.d.plainCss.match(cssReader.patternFetch)};this.fetchCssFilter=function(e){filterString=typeof e!="string"?filterString=e.join("|"):e;if(!(filterString in cssReader.patternFetchFilter))cssReader.patternFetchFilter[filterString]=new RegExp('([#.\\w\\s:,>\\-_*"=\\[\\]]+){(?:[^}]*(?:'+filterString+")+[^}]*)}","gi");t.d.fetchedCss=t.d.plainCss.match(cssReader.patternFetchFilter[filterString])};this.get=function(e){if(t.d.targetUrl){return $.ajax({url:t.d.targetUrl,success:function(n){t.setCss(n);e?t.fetchCssFilter(e):t.fetchCss()}})}};this.read=function(e){currentCssString=e?e:t.d.fetchedCss;for(var n=0,r=currentCssString.length;n<r;n++){if(matches=cssReader.patternRead.exec(currentCssString[n])){classNames=matches[1];classAttr=matches[2];if(classAttr&&classAttr.length>0){attrSplit=classAttr.split(";");attrContainerLength=t.attrIns.container.length;for(var i=0,s=attrSplit.length;i<s;i++){attrString=attrSplit[i];if(cssReader.patternProperty.test(attrString)){splittedAttrString=attrString.split(":");splittedKey=cssReader.getTrimStr(splittedAttrString[0]);splittedValue=cssReader.getTrimStr(splittedAttrString[1]);if(splittedKey.length>0&&splittedValue.length>0)t.attrIns.add(attrContainerLength,splittedKey,splittedValue)}}if(i>0){classParentFilter=classNames.indexOf(",")!=-1?classNames.split(","):[classNames];for(g=0,gl=classParentFilter.length;g<gl;g++){classString=classParentFilter[g];if(classString.length>0){trimmedClassString=cssReader.getTrimStr(classString);try{var o=cssReader.getClassPath($(trimmedClassString))}catch(u){var o=false}if(typeof o=="string")t.classIns.add(trimmedClassString,cssReader.getClassHash(o),o,attrContainerLength,t.refIns);else if(o===false)t.classIns.add(trimmedClassString,cssReader.getClassHash(trimmedClassString),false,attrContainerLength,t.refIns);else{for(y=0,yl=o.length;y<yl;y++)t.classIns.add(trimmedClassString,cssReader.getClassHash(o[y]),o[y],attrContainerLength,t.refIns)}}}}}}}return true};this.readFilter=function(e){filterString=typeof e!="string"?filterString=e.join("|"):e;if(!(filterString in cssReader.patternReadFilter))cssReader.patternReadFilter[filterString]=new RegExp("("+filterString+"):[^;]+;","gi");filterReg=cssReader.patternReadFilter[filterString];filteredCss=[];for(var n=0,r=t.d.fetchedCss.length;n<r;n++){if(filterReg.test(t.d.fetchedCss[n]))filteredCss.push(t.d.fetchedCss[n])}return t.read(filteredCss)};this.search=function(e,n){for(var r=0,i=t.refIns.container.keys.length;r<i;r++){for(var s=0,o=t.refIns.container[t.refIns.container.keys[r]].length;s<o;s++){cc=t.compiledIns.get(t.refIns.container[t.refIns.container.keys[r]][s],t.classIns,t.attrIns);if(n?n in cc:true)e.call(t,cc);else if(cssReader.attrInstance.debugPrefixString+n in cc)e.call(t,cc)}}};this.scrape=function(e){$.when(t.get()).done(function(){$.when(t.read()).done(function(){if(e)e.call(t,t.d)})})};this.scrapeFilter=function(e,n,r,i){$.when(r?t.get(n):t.get()).done(function(){$.when(i?t.readFilter(n):t.read()).done(function(){if(e)e.call(t,t.d)})})}};cssReader.patternFetch=new RegExp("([^}{]+{[^}{]*})","g");cssReader.patternFetchFilter={};cssReader.patternProperty=new RegExp("\\w+","");cssReader.patternRead=new RegExp("([^}{]+){((?:[^:]+:[^;]+;[\\s]*)+?)}","");cssReader.patternReadFilter={};cssReader.classInstance=function(){var e=this;this.container={keys:[]};this.add=function(t,n,r,i,s){if(!(n in e.container)){e.container[n]=[];e.container.keys.push(n)}e.container[n].push({lastPriority:cssReader.getClassPriority(t),classString:t,classPath:r,attrIndex:typeof i=="number"?i:false});s.add(t,n)}};cssReader.refInstance=function(){var e=this;this.container={keys:[]};this.add=function(t,n){if(!(t in e.container)){e.container[t]=[];e.container.keys.push(t)}e.container[t].push(n)}};cssReader.attrInstance=function(){var e=this;this.container=[];this.add=function(t,n,r){if(!(t in e.container))e.container[t]={keys:[]};if(typeof e.container[t][n]=="function")n=cssReader.attrInstance.debugPrefixString+n;if(!(n in e.container[t])){e.container[t][n]=[];e.container[t].keys.push(n)}e.container[t][n].push(r)}};cssReader.attrInstance.debugPrefixString="db_";cssReader.attrInstance.debugPrefixPattern=new RegExp("^"+cssReader.attrInstance.debugPrefixString,"i");cssReader.attrInstance.debugPrefixFilter=function(e){return e.replace(cssReader.attrInstance.debugPrefixPattern,"")};cssReader.compiledInstance=function(){var e=this;this.container={keys:[]};this.get=function(t,n,r){if(!(t in n.container))return false;if(!(t in e.container)){e.container[t]={keys:[]};e.container.keys.push(t);c=n.container[t];for(g=0,gl=c.length;g<gl;g++){a=r.container[c[g].attrIndex].keys;for(j=0,jl=a.length;j<jl;j++){ac=r.container[c[g].attrIndex][a[j]];ai=cssReader.isAttrImportant(ac);if(!(a[j]in e.container[t])){e.container[t].keys.push(a[j]);e.container[t][a[j]]={attrPriority:c[g].lastPriority,attrValue:ac,attrPath:c[g].classPath,attrClass:c[g].classString,attrImportant:ai}}else if(e.container[t][a[j]].attrImportant<ai||e.container[t][a[j]].attrPriority<=c[g].lastPriority&&e.container[t][a[j]].attrImportant==ai){e.container[t][a[j]]={attrPriority:c[g].lastPriority,attrValue:ac,attrPath:c[g].classPath,attrClass:c[g].classString,attrImportant:ai}}}}return e.container[t]}else return e.container[t]}};cssReader.getTrimStr=function(e){return e.replace(cssReader.getTrimStr.pattern,"")};cssReader.getTrimStr.pattern=new RegExp("^\\s+|\\s+$","g");cssReader.getCompressedCss=function(e){return e.replace(cssReader.getCompressedCss.patternComment,"").replace(cssReader.getCompressedCss.patternWhitespace,"")};cssReader.getCompressedCss.patternComment=new RegExp("\\/\\*[\\s\\S]+?\\*\\/","g");cssReader.getCompressedCss.patternWhitespace=new RegExp("[^\\S][\\s\\n\\r]*[^\\S]","g");cssReader.getClassHash=function(e){if(e.lenght==0)return false;hash=0;for(i=0,il=e.length;i<il;i++){hash=(hash<<5)-hash+e.charCodeAt(i);hash=hash&hash}return"md"+hash.toString()};cssReader.getClassPath=function(e){if(!e[0])return false;allClassPath=[];for(i=0,il=e.length;i<il;i++){current=e.eq(i);parents=current.parents("*");classPath="";for(j=0,jl=parents.length;j<jl;j++){classString=(className=parents[j].className)?"."+className.replace(cssReader.getClassPath.pattern,"."):"";idString=(idName=parents[j].getAttribute("id"))?"#"+idName.replace(cssReader.getClassPath.pattern,"#"):"";classPath=parents[j].tagName.toLowerCase()+idString+classString+" "+classPath}allClassPath.push(classPath.replace(cssReader.getClassPath.pattern," > ")+e[i].tagName.toLowerCase()+((className=e[i].className)?"."+className.replace(cssReader.getClassPath.pattern,"."):"")+((idName=e[i].getAttribute("id"))?"#"+idName.replace(cssReader.getClassPath.pattern,"#"):""))}return allClassPath.length>0?allClassPath:false};cssReader.getClassPath.pattern=new RegExp("\\s","g");cssReader.getClassPriority=function(e){rating=0;rating+=(matches=e.match(cssReader.getClassPriority.patternId))?matches.length*100:0;rating+=(matches=e.match(cssReader.getClassPriority.patternClass))?matches.length*10:0;rating+=(matches=e.replace(cssReader.getClassPriority.patternReplace,"").match(cssReader.getClassPriority.patternAll))?matches.length*1:0;return rating};cssReader.getClassPriority.patternId=new RegExp("#[^\\s\\.#]+","g");cssReader.getClassPriority.patternClass=new RegExp("\\.[^\\s\\.#]+","g");cssReader.getClassPriority.patternAll=new RegExp("[^\\s]+(?=#|\\.)?","g");cssReader.getClassPriority.patternReplace=new RegExp("[#\\.][^\\s\\.#]+","g");cssReader.isAttrImportant=function(e){return cssReader.isAttrImportant.pattern.test(e)};cssReader.isAttrImportant.pattern=new RegExp("!important$","gi")
