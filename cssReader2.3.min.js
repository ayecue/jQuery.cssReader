var classInstance=function(){var e=this;this.container=[];this.free=function(){if(e.container.length>0){delete e.container;e.container=[]}};this.add=function(t,n,r,i,s){if(!(n in e.container))e.container[n]=[];e.container[n].push({lastPriority:cssReader.getClassPriority(t),classString:t,classPath:r,attrIndex:typeof i=="number"?i:false});s.add(t,n)};this.get=function(t){return t in e.container?e.container[t]:false}};var refInstance=function(){var e=this;this.container=[];this.free=function(){if(e.container.length>0){delete container;container=[]}};this.add=function(t,n){if(!(t in e.container))e.container[t]=[];e.container[t].push(n)};this.get=function(t){return t in e.container?e.container[t]:false}};var compiledInstance=function(){var e=this;this.container=[];this.free=function(){if(e.container.length>0){delete e.container;e.container=[]}};this.get=function(t,n,r){if(!(t in n.container))return false;if(!(t in e.container)){e.container[t]=[];$.each(n.get(t),function(n,i){var s=r.get(i.attrIndex);for(attrKey in s){var o=cssReader.isAttrImportant(s[attrKey]);if(!(attrKey in e.container)||e.container[t][attrKey].attrImportant<o||e.container[t][attrKey].attrPrio<=i.lastPriority&&e.container[t][attrKey].attrImportant==o){e.container[t][attrKey]={attrPrio:i.lastPriority,attrValue:s[attrKey],attrPath:i.classPath,attrClass:i.classString,attrImportant:o}}}});return e.container[t]}else return e.container[t]}};var attrInstance=function(){var e=this;this.container=[];this.free=function(){if(e.container.length>0){delete e.container;e.container=[]}};this.add=function(t,n,r){if(!(t in e.container))e.container[t]=[];if(!(n in e.container[t]))e.container[t][n]=[];if(typeof e.container[t][n]!="object"){delete e.container[t][n];n=attrInstance.debugPrefixString+n;e.container[t][n]=[]}e.container[t][n].push(r)};this.get=function(t){return t in e.container?e.container[t]:false}};attrInstance.debugPrefixString="db_";attrInstance.debugPrefixPattern=new RegExp("^"+attrInstance.debugPrefixString,"i");attrInstance.debugPrefixFilter=function(e){return e.replace(attrInstance.prefixPattern,"")};var cssReader=function(e){var t=this;var n={targetUrl:"",plainCss:"",fetchedCss:""};this.classIns=new classInstance;this.refIns=new refInstance;this.compiledIns=new compiledInstance;this.attrIns=new attrInstance;this.d=$.extend(n,e);this.setUrl=function(e){t.d.targetUrl=e};this.setCss=function(e){t.d.plainCss=cssReader.getCompressedCss(e)};this.fetchCss=function(){t.d.fetchedCss=t.d.plainCss.match(/([#.\w\s:,>\-_*"=\[\]]+){(?:[^}]*)}/gi)};this.fetchCssFilter=function(e){var n=typeof e!="string"?n=e.join("|"):e;t.d.fetchedCss=t.d.plainCss.match(new RegExp('([#.\\w\\s:,>\\-_*"=\\[\\]]+){(?:[^}]*(?:'+n+")+[^}]*)}","gi"))};this.get=function(e){if(t.d.targetUrl){return $.ajax({url:t.d.targetUrl,success:function(n){t.setCss(n);e?t.fetchCssFilter(e):t.fetchCss()}})}};this.read=function(e){var n=e?e:t.d.fetchedCss;if(n.length>0){return $.each(n,function(e,n){var r=n.replace(/{([^}]*)}/gi,"").match(/(?:[#.\w\s:,>\-_*"=\[\]]+)/gi);var i=n.match(/[^}{*\/]+:[^}{]*[^*\/]*?;?/gi,"");var s=0;if(i[0].length>0){var o=t.attrIns.container.length;$.each(i[0].split(";"),function(e,n){if(n.length>0){var r=n.split(":");var i=cssReader.getTrimStr(r[0]);var u=cssReader.getTrimStr(r[1]);if(i.length>0&&u.length>0)t.attrIns.add(o,i,u)}s++});if(s>0){$.each(r,function(e,n){var r=n.indexOf(",")!=-1?n.split(","):[n];$.each(r,function(e,n){if(n.length>0){var r=cssReader.getTrimStr(n);try{var i=cssReader.getClassPath($(r))}catch(s){var i=false}if(typeof i=="string")t.classIns.add(r,cssReader.getClassHash(i),i,o,t.refIns);else if(i===false)t.classIns.add(r,cssReader.getClassHash(r),false,o,t.refIns);else $.each(i,function(e,n){t.classIns.add(r,cssReader.getClassHash(n),n,o,t.refIns)})}})})}}})}};this.readFilter=function(e){var n=typeof e!="string"?n=e.join("|"):e;var r=new RegExp("("+n+"):[^}{]*[^*\\/]*?;","gi");var i=[];$.each(t.d.fetchedCss,function(e,t){if(t.match(r))i.push(t)});return t.read(i)};this.search=function(e,n){for(classIndex in t.classIns.container){var r=t.compiledIns.get(classIndex,t.classIns,t.attrIns);if(n?n in r:true)e.call(t,r);else if(attrInstance.debugPrefixString+n in r)e.call(t,r)}};this.scrape=function(e){$.when(t.get()).done(function(){$.when(t.read()).done(function(){if(e)e.call(t,t.d)})})};this.scrapeFilter=function(e,n,r,i){$.when(r?t.get(n):t.get()).done(function(){$.when(i?t.readFilter(n):t.read()).done(function(){if(e)e.call(t,t.d)})})}};cssReader.getTrimStr=function(e){return e.replace(/^\s+|\s+$/g,"")};cssReader.getCompressedCss=function(e){return e.replace(/\/\*[\s\S]+?\*\//g,"").replace(/[^\S][\s\n\r]*[^\S]/g,"")};cssReader.getClassHash=function(e){if(e.lenght==0)return false;var t=0;$.each(e,function(n){t=(t<<5)-t+e.charCodeAt(n);t=t&t});return t.toString()};cssReader.getClassPath=function(e){var t=$(e);if(!t[0])return false;var n=[];t.each(function(){var e="";var t=$(this);t.parents("*").each(function(){var t=$(this);var n=(className=t.attr("class"))?"."+className.replace(/\s/gi,"."):"";var r=(idName=t.attr("id"))?"#"+idName.replace(/\s/gi,"#"):"";e=t[0].tagName.toLowerCase()+r+n+" "+e});n.push(e.replace(/\s/gi," > ")+t[0].tagName.toLowerCase()+((className=t.attr("class"))?"."+className.replace(/\s/gi,"."):"")+((idName=t.attr("id"))?"#"+idName.replace(/\s/gi,"#"):""))});return n.length>0?n:false};cssReader.getClassPriority=function(e){var t=0;var n=e.split(" ");for(parentParts in n){if(/[#.][\w:\-_"=\[\]]+/.test(n[parentParts])){try{t+=(id=n[parentParts].match(/#[\w:\-_"=\[\]]+/gi))?id.length*100:0;t+=(cl=n[parentParts].match(/\.[\w:\-_"=\[\]]+/gi))?cl.length*10:0;t+=(tg=n[parentParts].match(/\w+[#.]/gi))?tg.length*1:0}catch(r){t+=(id=n[parentParts].toString().match(/#[\w:\-_"=\[\]]+/gi))?id.length*100:0;t+=(cl=n[parentParts].toString().match(/\.[\w:\-_"=\[\]]+/gi))?cl.length*10:0;t+=(tg=n[parentParts].toString().match(/\w+[#.]/gi))?tg.length*1:0}}else if(/[^>]+/.test(n[parentParts]))t++}return t};cssReader.isAttrImportant=function(e){return/!important$/.test(e)}