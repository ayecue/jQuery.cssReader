var cssReaderLess=function(e){var t=this;var n={targetUrl:"",plainCss:"",fetchedCss:""};this.classIns=new cssReaderLess.classInstance;this.refIns=new cssReaderLess.refInstance;this.compiledIns=new cssReaderLess.compiledInstance;this.attrIns=new cssReaderLess.attrInstance;this.d=$.extend(n,e);this.setUrl=function(e){t.d.targetUrl=e};this.setCss=function(e){t.d.plainCss=cssReaderLess.getCompressedCss(e)};this.fetchCss=function(){t.d.fetchedCss=t.d.plainCss.match(cssReaderLess.patternFetch)};this.fetchCssFilter=function(e){filterString=typeof e!="string"?filterString=e.join("|"):e;if(!(filterString in cssReaderLess.patternFetchFilter))cssReaderLess.patternFetchFilter[filterString]=new RegExp('([#.\\w\\s:,>\\-_*"=\\[\\]]+){(?:[^}]*(?:'+filterString+")+[^}]*)}","gi");t.d.fetchedCss=t.d.plainCss.match(cssReaderLess.patternFetchFilter[filterString])};this.get=function(e){if(t.d.targetUrl){return $.ajax({url:t.d.targetUrl,success:function(n){t.setCss(n);e?t.fetchCssFilter(e):t.fetchCss()}})}};this.read=function(e){currentCssString=e?e:t.d.fetchedCss;for(var n=0,r=currentCssString.length;n<r;n++){if(matches=cssReaderLess.patternRead.exec(currentCssString[n])){classNames=matches[1];classProperties=matches[2];if(classProperties&&classProperties.length>0){propSplit=classProperties.split(";");propLength=t.attrIns.container.length;for(var i=0,s=propSplit.length;i<s;i++){propString=propSplit[i];if(cssReaderLess.patternProperty.test(propString)){splittedPropString=propString.split(":");splittedKey=cssReaderLess.getTrimStr(splittedPropString[0]);splittedValue=cssReaderLess.getTrimStr(splittedPropString[1]);if(splittedKey.length>0&&splittedValue.length>0)t.attrIns.add(propLength,splittedKey,splittedValue)}}if(i>0){classes=classNames.indexOf(",")!=-1?classNames.split(","):[classNames];for(g=0,gl=classes.length;g<gl;g++){classString=classes[g];if(classString.length>0){trimmedClassString=cssReaderLess.getTrimStr(classString);try{var o=cssReaderLess.getClassPath($(trimmedClassString))}catch(u){var o=false}if(typeof o=="string")t.classIns.add(trimmedClassString,cssReaderLess.getClassHash(o),o,propLength,t.refIns);else if(o===false)t.classIns.add(trimmedClassString,cssReaderLess.getClassHash(trimmedClassString),false,propLength,t.refIns);else{for(y=0,yl=o.length;y<yl;y++)t.classIns.add(trimmedClassString,cssReaderLess.getClassHash(o[y]),o[y],propLength,t.refIns)}}}}}}}return true};this.readFilter=function(e){filterString=typeof e!="string"?filterString=e.join("|"):e;if(!(filterString in cssReaderLess.patternReadFilter))cssReaderLess.patternReadFilter[filterString]=new RegExp("("+filterString+"):[^;]+;","gi");filterReg=cssReaderLess.patternReadFilter[filterString];filteredCss=[];for(var n=0,r=t.d.fetchedCss.length;n<r;n++){if(filterReg.test(t.d.fetchedCss[n]))filteredCss.push(t.d.fetchedCss[n])}return t.read(filteredCss)};this.search=function(e,n){for(var r=0,i=t.refIns.container.keys.length;r<i;r++){for(var s=0,o=t.refIns.container[t.refIns.container.keys[r]].length;s<o;s++){cc=t.compiledIns.get(t.refIns.container[t.refIns.container.keys[r]][s],t.classIns,t.attrIns);if(n?n in cc:true)e.call(t,cc);else if(cssReaderLess.attrInstance.debugPrefixString+n in cc)e.call(t,cc)}}};this.scrape=function(e){$.when(t.get()).done(function(){$.when(t.read()).done(function(){if(e)e.call(t,t.d)})})};this.scrapeFilter=function(e,n,r,i){$.when(r?t.get(n):t.get()).done(function(){$.when(i?t.readFilter(n):t.read()).done(function(){if(e)e.call(t,t.d)})})}};cssReaderLess.patternFetch=new RegExp("([^}{]+{[^}{]*})","g");cssReaderLess.patternFetchFilter={};cssReaderLess.patternProperty=new RegExp("\\w+","");cssReaderLess.patternRead=new RegExp("([^}{]+){((?:[^:]+:[^;]+;[\\s]*)+?)}","");cssReaderLess.patternReadFilter={};cssReaderLess.classInstance=function(){var e=this;this.container={keys:[]};this.add=function(t,n,r,i,s){if(!(n in e.container)){e.container[n]=[];e.container.keys.push(n)}e.container[n].push({priority:cssReaderLess.getClassPriority(t),string:t,path:r,properties:typeof i=="number"?i:false});s.add(t,n)}};cssReaderLess.refInstance=function(){var e=this;this.container={keys:[]};this.add=function(t,n){if(!(t in e.container)){e.container[t]=[];e.container.keys.push(t)}e.container[t].push(n)}};cssReaderLess.attrInstance=function(){var e=this;this.container=[];this.add=function(t,n,r){if(!(t in e.container))e.container[t]={keys:[]};if(typeof e.container[t][n]=="function")n=cssReaderLess.attrInstance.debugPrefixString+n;if(!(n in e.container[t])){e.container[t][n]=[];e.container[t].keys.push(n)}e.container[t][n].push({value:r,important:cssReaderLess.isAttrImportant(r)})}};cssReaderLess.attrInstance.debugPrefixString="db_";cssReaderLess.attrInstance.debugPrefixPattern=new RegExp("^"+cssReaderLess.attrInstance.debugPrefixString,"i");cssReaderLess.attrInstance.debugPrefixFilter=function(e){return e.replace(cssReaderLess.attrInstance.debugPrefixPattern,"")};cssReaderLess.compiledInstance=function(){var e=this;this.container={keys:[]};this.get=function(t,n,r){if(!(t in n.container))return false;if(!(t in e.container)){var i;e.container[t]={keys:[]};e.container.keys.push(t);c=n.container[t];for(g=0,gl=c.length;g<gl;g++){a=r.container[c[g].properties].keys;for(j=0,jl=a.length;j<jl;j++){ac=r.container[c[g].properties][a[j]];if(!(a[j]in e.container[t])){e.container[t].keys.push(a[j]);e.container[t][a[j]]={classIns:c[g],propIns:ac};i=c[g]}else if(r.container[i.properties].important<ac.important||i.priority<=c[g].priority&&r.container[i.properties].important==ac.important){e.container[t][a[j]]={classIns:c[g],propIns:ac};i=c[g]}}}return e.container[t]}else return e.container[t]}};cssReaderLess.getTrimStr=function(e){return e.replace(cssReaderLess.getTrimStr.pattern,"")};cssReaderLess.getTrimStr.pattern=new RegExp("^\\s+|\\s+$","g");cssReaderLess.getCompressedCss=function(e){return e.replace(cssReaderLess.getCompressedCss.patternComment,"").replace(cssReaderLess.getCompressedCss.patternWhitespace,"")};cssReaderLess.getCompressedCss.patternComment=new RegExp("\\/\\*[\\s\\S]+?\\*\\/","g");cssReaderLess.getCompressedCss.patternWhitespace=new RegExp("[^\\S][\\s\\n\\r]*[^\\S]","g");cssReaderLess.getClassHash=function(e){if(e.lenght==0)return false;hash=0;for(i=0,il=e.length;i<il;i++){hash=(hash<<5)-hash+e.charCodeAt(i);hash=hash&hash}return"md"+hash.toString()};cssReaderLess.getSelectors=function(e){if(x=e.localName)return x+((i=e.id).length>0?"#"+i:"")+((c=e.className).length>0?"."+c.replace(cssReaderLess.getClassPath.pattern,"."):"");return false};cssReaderLess.getClassPathEx=function(e){if(!e)return false;if(!("cssReaderLess_PathEx"in e)){var t=e.parentNode,n="",r;if("cssReaderLess_PathEx"in t)return e.cssReaderLess_PathEx=t.cssReaderLess_PathEx+">"+cssReaderLess.getSelectors(e);while(r=cssReaderLess.getSelectors(t)){if("cssReaderLess_PathEx"in t){n=t.cssReaderLess_PathEx+">"+n;break}n=r+">"+n;t=t.parentNode}return e.cssReaderLess_PathEx=n+cssReaderLess.getSelectors(e)}return e.cssReaderLess_PathEx};cssReaderLess.getClassPath=function(e){if((vl=e.length)>1){stack=[];for(v=0;v<vl;v++)stack.push(cssReaderLess.getClassPathEx(e[v]));return stack}return cssReaderLess.getClassPathEx(e[0])};cssReaderLess.getClassPath.pattern=new RegExp("\\s","g");cssReaderLess.getClassPriority=function(e){rating=0;rating+=(matches=e.match(cssReaderLess.getClassPriority.patternId))?matches.length*100:0;rating+=(matches=e.match(cssReaderLess.getClassPriority.patternClass))?matches.length*10:0;rating+=(matches=e.replace(cssReaderLess.getClassPriority.patternReplace,"").match(cssReaderLess.getClassPriority.patternAll))?matches.length*1:0;return rating};cssReaderLess.getClassPriority.patternId=new RegExp("#[^\\s\\.#]+","g");cssReaderLess.getClassPriority.patternClass=new RegExp("\\.[^\\s\\.#]+","g");cssReaderLess.getClassPriority.patternAll=new RegExp("[^\\s]+(?=#|\\.)?","g");cssReaderLess.getClassPriority.patternReplace=new RegExp("[#\\.][^\\s\\.#]+","g");cssReaderLess.isAttrImportant=function(e){return cssReaderLess.isAttrImportant.pattern.test(e)};cssReaderLess.isAttrImportant.pattern=new RegExp("!important$","gi")
