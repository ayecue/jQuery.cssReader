(function(e){"use strict";var t={reader:{property:/([^:]+):([^;]+);/g,name:/[^,]+(\[[^\]]+\])|[^,]+/g,style:/([^}{]+){([^}{]*)}/g},staticClass:{classSpaces:/\s+/g,priorityId:/#[^\s\.#]+/g,priorityClass:/\.[^\s\.#]+/g,priorityTagReplace:/[#\.][^\s\.#]+/g,priorityTag:/[^\s]+(?=#|\.)?/g,trim:/^\s+|\s+$/g,important:/!important$/gi,compress:/\/\*[\s\S]+?\*\/|[^\S][\s\n\r]*[^\S]|[^{}]+{[^\S{}]*?}/g}},n={DOMIndex:{index:0,get:function(e){return e.DOMIndex||(e.DOMIndex=this.index++)}},type:{handler:{object:function(e){return e instanceof Array?"array":"object"}},get:function(e){var t=typeof e;return this.handler[t]?this.handler[t](e):t}},priority:{stack:{},create:function(e){var n;return this.stack[e]=((n=e.match(t.staticClass.priorityId))?n.length*100:0)+((n=e.match(t.staticClass.priorityClass))?n.length*10:0)+((n=e.replace(t.staticClass.priorityTagReplace,"").match(t.staticClass.priorityTag))?n.length*1:0)},get:function(e){return this.stack[e]||this.create(e)}},hash:{handler:{string:function(e){var t=0,n=e.length;while(n--){t=(t<<5)-t+e.charCodeAt(n);t=t&t}return"d:"+t.toString()},array:function(e){return"e:"+n.DOMIndex.get(e[0])}},get:function(e){var t=n.type.get(e);return this.handler[t]?this.handler[t](e):false}},path:{get:function(e){var t=e.length||0;if(t<=1)return e[0]?this.create(e[0]):false;var n=[];for(var r=0;r<t;r++)n.push(this.create(e[r]));return n},create:function(e){if(!e.pathStack){var t=e,n=[];while(this.selector.get(t)){this.nodeIndex.get(t);n.push(t);t=t.parentNode;if(t.pathStack)return e.pathStack=n.concat(t.pathStack)}return e.pathStack=n}return e.pathStack},selector:{create:function(e){var n=e.tagName,r,i;return n?n+((r=e.id).length>0?"#"+r:"")+((i=e.className).length>0?"."+i.replace(t.staticClass.classSpaces,"."):""):false},get:function(e){return e.selectors||this.create(e)}},nodeIndex:{create:function(e){var t=e.previousSibling,n=0;while(t){if(t.childNodesIndex)return e.childNodesIndex=t.childNodesIndex+1;t=t.previousSibling;n++}return e.childNodesIndex=n},get:function(e){return e.childNodesIndex||this.create(e)}}},text:{isImportant:function(e){return t.staticClass.important.test(e)},trimBoth:function(e){return e.replace(t.staticClass.trim,"")},compressText:function(e){return e.replace(t.staticClass.compress,"")}}},r=function(r){var i=e.extend({stylesheet:false,filter:false},r);return{filter:{handler:{array:function(){return new RegExp("([^;]*(?:"+i.filter.join("|")+")[^:]*):([^;]+);","g")},string:function(){return new RegExp("([^;]*(?:"+i.filter+")[^:]*):([^;]+);","g")}},set:function(e){i.filter=e},get:function(){var e=n.type.get(i.filter);return this.handler[e]?this.handler[e]():t.reader.property}},CSSStyleSheet:{set:function(e){i.stylesheet=e},get:function(){return i.stylesheet},reset:function(){inactive.stack={};inactive.ref=[];active.stack={};active.ref=[]},inactive:{stack:{},ref:[],add:function(e){if(!this.stack[e.hash]){this.stack[e.hash]=[];this.ref.push(this.stack[e.hash])}this.stack[e.hash].push({property:e.properties,selector:e.selector})}},active:{stack:{},ref:[],add:function(e){var t=e.properties.keys.length,r=n.priority.get(e.selector);if(!this.stack[e.hash]){this.stack[e.hash]={keys:[]};this.ref.push(this.stack[e.hash])}for(var i=0;i<t;i++){var s=e.properties.keys[i];if(!this.stack[e.hash][s]){this.stack[e.hash][s]={priority:r,property:e.properties[s],selector:e.selector,path:e.path};this.stack[e.hash].keys.push(s)}else if(this.stack[e.hash][s].property.important<e.properties[s].important||this.stack[e.hash][s].priority<=r&&this.stack[e.hash][s].property.important==e.properties[s].important){this.stack[e.hash][s].priority=r;this.stack[e.hash][s].property=e.properties[s];this.stack[e.hash][s].selector=e.selector}}}},add:function(t){var r=n.text.trimBoth(t.selector),i=e(r),s=n.path.get(i)||false;if(s===false)return this.inactive.add({selector:r,hash:n.hash.get(r),properties:t.properties});var o=i.length;if(o<=1)return this.active.add({selector:r,hash:n.hash.get(s),path:s,properties:t.properties});while(o--)this.active.add({selector:r,hash:n.hash.get(s[o]),path:s[o],properties:t.properties});return true}},read:{handler:{string:function(e){if(e.stylesheet.length>0){var n;while(n=t.reader.style.exec(e.stylesheet))e.callback(e.parent,{propertyFilter:e.propertyFilter,properties:n[2],nameFilter:e.nameFilter,names:n[1]});return true}return false},array:function(e){var n=e.stylesheet.length;if(fetchedStringLenght>0){for(var r=0;r<n;r++){var i=e.stylesheet[r].match(t.reader.style);e.callback(e.parent,{propertyFilter:e.propertyFilter,properties:i[2],nameFilter:e.nameFilter,names:i[1]})}return true}return false},object:function(e){var t=e.stylesheet.length;if(t>0){for(var n=0;n<t;n++)e.callback(e.parent,{propertyFilter:e.propertyFilter,properties:e.stylesheet[n].style.cssText,nameFilter:e.nameFilter,names:e.stylesheet[n].selectorText});return true}return false}},controller:function(e,t){var r=t.properties,i=r.length;if(i>0){var s=t.names,o,u={keys:[]};while(o=t.propertyFilter.exec(r)){u[o[1]]={value:o[2],important:n.text.isImportant(o[2])};u.keys.push(o[1])}if(u.keys.length>0)while(o=t.nameFilter.exec(s))e.CSSStyleSheet.add({selector:o[0],properties:u})}},exec:function(e){var r=e.CSSStyleSheet.get(),i=n.type.get(r);return this.handler[i]?this.handler[i]({stylesheet:r,parent:e,propertyFilter:e.filter.get(),nameFilter:t.reader.name,callback:this.controller}):false}},scrape:function(t){var n=this;e.when(this.read.exec(n)).done(function(){if(t)t(n,n.CSSStyleSheet)})}}};e.extend(r.prototype,{fetchFilter:{handler:{array:function(e){return new RegExp("([^}{]+){(?:[^}{]*(?:"+e.join("|")+")[^}{]*)}","g")},string:function(e){return new RegExp("([^}{]+){(?:[^}{]*(?:"+e+")[^}{]*)}","g")}},get:function(e){var r=n.type.get(e);return this.handler[r]?this.handler[r](e):t.reader.style}}});String.prototype.readStylesheet=function(e){var t=new r({stylesheet:e.fetch?n.text.compressText(this).match(r.fetchFilter.get()):n.text.compressText(this),filter:e.filter||false});t.scrape(function(t,n){e.callback(n)});return t};e.readStylesheet=function(e){var t=new r({stylesheet:e.stylesheet.rules,filter:e.filter||false});t.scrape(function(t,n){e.callback(n)});return t};e.readStylesheetAjax=function(t){return e.ajax({url:t.url,success:function(e){e.readStylesheet(t)}})}})(jQuery)