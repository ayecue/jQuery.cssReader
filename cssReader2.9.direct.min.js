var cssReader=function(e){var t={targetUrl:"",plainCss:"",fetchedCss:""};cssReader.extend(this,{d:$.extend(t,e),patternFilter:{},classIns:{container:{keys:[]},add:function(e,t,n,r,i){if(!(t in this.container)){this.container[t]=[];this.container.keys.push(t)}this.container[t].push({priority:cssReader.getPriority(e),name:e,path:n,properties:typeof r=="number"?r:false});i.add(e,t)}},refIns:{container:{keys:[]},add:function(e,t){if(!(e in this.container)){this.container[e]=[];this.container.keys.push(e)}this.container[e].push(t)}},compiledIns:{container:{keys:[]},get:function(e,t,n){if(!(e in t.container))return false;if(!(e in this.container)){var r=t.container[e];this.container[e]={keys:[]};this.container.keys.push(e);for(g=0,gl=r.length;g<gl;g++){var i=n.container[r[g].properties].keys,s=i.length;while(--s>=0){var o=n.container[r[g].properties][i[s]],u=cssReader.isImportant(o);if(!(i[s]in this.container[e])){this.container[e].keys.push(i[s]);this.container[e][i[s]]={priority:r[g].priority,value:o,path:r[g].path,name:r[g].name,important:u}}else if(this.container[e][i[s]].important<u||this.container[e][i[s]].priority<=r[g].priority&&this.container[e][i[s]].important==u){this.container[e][i[s]].priority=r[g].priority;this.container[e][i[s]].value=o;this.container[e][i[s]].path=r[g].path;this.container[e][i[s]].name=r[g].name;this.container[e][i[s]].important=u}}}return this.container[e]}else return this.container[e]}},attrIns:{container:[],add:function(e,t,n){if(!(e in this.container))this.container[e]={keys:[]};if(typeof this.container[e][t]=="function")t="db_"+t;if(!(t in this.container[e])){this.container[e][t]=[];this.container[e].keys.push(t)}this.container[e][t].push(n)}},setUrl:function(e){this.d.targetUrl=e},setCss:function(e,t){this.d.plainCss=cssReader.compressCss(e);if(t)this.filterCss(t)},filterCss:function(e){var t=typeof e!="string"?t=e.join("|"):e;if(!(t in this.patternFilter))this.patternFilter[t]=new RegExp("[^{}]+{[^{}]*(?:"+t+")[^{}]*}","gi");this.d.plainCss=this.d.plainCss.match(this.patternFilter[t]).join("")},get:function(e){var t=this;if(this.d.targetUrl){return $.ajax({url:this.d.targetUrl,success:function(n){t.setCss(n,e?e:null)}})}},read:function(e){var t=e?e:this.d.plainCss,n,r;while((n=cssReader.patternClasses.exec(t))&&(r=cssReader.patternProperties.exec(t))){var i=r[0].split(";"),s=this.attrIns.container.length,o=i.length;while(--o>=0){var u=i[o];if(cssReader.patternProperty.test(u)){var a=u.split(":"),f=cssReader.trimBoth(a[0]),l=cssReader.trimBoth(a[1]);if(f.length>0&&l.length>0)this.attrIns.add(s,f,l)}}var c=n[0].split(","),h=c.length;while(--h>=0){var p=c[h];if(p.length>0){var d=cssReader.trimBoth(p),v=$(d),m=v?cssReader.getPath(v):false;if(m===false)this.classIns.add(d,cssReader.getStringHash(d),false,s,this.refIns);else{if(v.length>1){var g=v.length;while(--g>=0)this.classIns.add(d,cssReader.getStringHash(m[g]),m[g],s,this.refIns)}else this.classIns.add(d,cssReader.getStringHash(m),m,s,this.refIns)}}}}return true},search:function(e,t){var n=this.refIns.container.keys.length;while(--n>=0){var r=this.refIns.container[this.refIns.container.keys[n]].length;while(--r>=0){var i=this.compiledIns.get(this.refIns.container[this.refIns.container.keys[n]][r],this.classIns,this.attrIns);if(t?t in i:true)e.call(this,i);else if("db_"+t in i)e.call(this,i)}}},scrape:function(e,t){var n=this;$.when(t?n.get(t):n.get()).done(function(){$.when(n.read()).done(function(){if(e)e.call(n,n.d)})})}})};cssReader.extend=function(e,t){for(func in t)e[func]=t[func]};cssReader.extend(cssReader,{patternClasses:/[^{}]+(?={)/g,patternProperties:/[^{}]+(?=})/g,patternProperty:/\w+/,debugPrefixFilter:function(e){return e.replace(/^db_/,"")},DOMIndex:0,getIndex:function(e){if(!("DOMIndex"in e))return e.DOMIndex=this.DOMIndex++;return e.DOMIndex},nodeIndexOf:function(t){if("childNodesIndex"in t)return t.childNodesIndex;if(e=t.previousSibling){var n=0;while(e){if("childNodesIndex"in e)return t.childNodesIndex=e.childNodesIndex+1;n++;e=e.previousSibling}return t.childNodesIndex=n}return-1},getSelectors:function(e){if("selectors"in e)return e.selectors;if(x=e.tagName)return e.selectors=x.toLowerCase()+((i=e.id).length>0?"#"+i:"")+((c=e.className).length>0?"."+c.replace(/\s+/g,"."):"");return false},getPathEx:function(e){if(!("pathStack"in e)){var t=e,n=[];while(this.getSelectors(t)){this.nodeIndexOf(t);n.push(t);t=t.parentNode;if("pathStack"in t)return e.pathStack=n.concat(t.pathStack)}return e.pathStack=n}return e.pathStack},getPriority:function(e){var t=(matches=e.match(/#[^\s\.#]+/g))?matches.length*100:0;t+=(matches=e.match(/\.[^\s\.#]+/g))?matches.length*10:0;t+=(matches=e.replace(/[#\.][^\s\.#]+/g,"").match(/[^\s]+(?=#|\.)?/g))?matches.length*1:0;return t},isImportant:function(e){if(typeof e!="string"){var t=e.length;while(--t>=0)if(/!important$/gi.test(e[t]))return true;return false}return/!important$/gi.test(e)},trimBoth:function(e){return e.replace(/^\s+|\s+$/g,"")},compressCss:function(e){return e.replace(/\/\*[\s\S]+?\*\/|[^\S][\s\n\r]*[^\S]|[^{}]+{[^\S{}]*?}/g,"")},getStringHash:function(e){if((i=e.length)==0)return false;if(typeof e=="string"){var t=0;while(--i>=0){t=(t<<5)-t+e.charCodeAt(i);t=t&t}return"d:"+t.toString()}return"e:"+cssReader.getIndex(e[0])},getPath:function(e){if((vl=e.length)>1){var t=[];for(var n=0;n<vl;n++)t.push(cssReader.getPathEx(e[n]));return t}return e.length>0?cssReader.getPathEx(e[0]):false}})